<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Virtual Laboratorium â€“ Uji Iodin (Lugol)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#eef3ff; --panel2:#dbe6ff; --accent:#f59e0b;
    --text:#eaf2ff; --ink:#0f172a; --muted:#6b7280; --ok:#10b981;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--text);
    background: radial-gradient(1400px 900px at 80% -10%, #1b2c68 0%, #0b1020 60%, #050713 100%);
    overflow-x:hidden;
  }

  /* ===== Title ===== */
  .title{position:sticky; top:0; text-align:center; padding:12px; z-index:50;
    font-weight:900; font-size:clamp(22px,3.6vw,40px); letter-spacing:.4px;
    color:#ffe6e6; text-shadow:0 5px 18px #0009, 0 1px 0 #fff3;
    background:linear-gradient(180deg, #0b1020aa, transparent);
    backdrop-filter: blur(6px);
  }

  /* ===== Layout ===== */
  .stage-wrap{display:none} .stage-wrap.active{display:block}
  .grid-2{display:grid; grid-template-columns:38% 1fr; gap:16px; padding:16px 20px 26px; min-height:calc(100dvh - 64px)}
  .grid-1{display:grid; grid-template-columns:1fr; gap:16px; padding:16px 20px 26px; min-height:calc(100dvh - 64px)}
  .col{position:relative}

  /* ===== Card ===== */
  .card{
    position:relative; height:min(78vh, 780px);
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    border:2px solid #c7d2fe; border-radius:16px; box-shadow:0 18px 50px #0007;
    display:grid; grid-template-rows:auto 1fr auto; padding:16px; color:var(--ink);
  }
  .sign{margin:0 auto 10px; width:min(560px,92%); text-align:center; padding:14px 16px;
    background:#fffffff2; border:2px solid #a5b4fc; border-radius:12px; font-weight:800}
  .controls{display:flex; justify-content:center; gap:10px; margin-top:10px}
  .btn{background:var(--accent); color:#111; font-weight:800; padding:10px 16px; border:0; border-radius:12px; cursor:pointer}
  .btn:disabled{opacity:.5; cursor:not-allowed}
  .back{background:#cbd5e1; color:#0f172a}
  .plinth{position:absolute; left:50%; bottom:-14px; transform:translateX(-50%);
    width:min(520px,90%); height:34px; background:linear-gradient(#b68b6b,#915f3e); border-radius:0 0 12px 12px; box-shadow:0 14px 30px #0008}

  /* ===== Shelf / Slots ===== */
  .slots{position:relative; height:78vh; background:#e5ecff; border-radius:16px; padding:14px; border:2px solid #c7d2fe; box-shadow:0 18px 40px #0006}
  .row{display:flex; gap:12px; align-items:center; padding:6px 0}
  .slot{flex:0 0 auto; width:64px; height:64px; border-radius:12px; display:grid; place-items:center; background:#ffffffcc; border:2px solid #eef; cursor:pointer; transition:.12s}
  .slot img{max-width:54px; max-height:54px; user-select:none}
  .slot:hover{transform:translateY(-2px)} .slot.selected{outline:3px solid var(--ok); box-shadow:0 0 0 6px #10b98133}

  /* ===== Stage 3 (uji) ===== */
  .bench{justify-self:center; width:min(980px,96%); background:linear-gradient(#efcf9a,#c39254); border-radius:14px; padding:14px; box-shadow:inset 0 3px 0 #fff6}
  .panel h3{margin:6px 0 10px; text-align:center}
  .plates{display:flex; gap:18px; justify-content:center; flex-wrap:wrap; padding:8px 0 14px}
  .plate{width:140px; height:140px; border-radius:50%; display:grid; place-items:center; background:#f3f4f6; box-shadow:inset 0 10px 18px #0002; position:relative; border:3px solid #d1d5db; user-select:none; color:#0f172a; font-weight:900}
  .plate .label{position:absolute; bottom:-24px; width:100%; text-align:center}
  .bb{background:#0c1e4a; border-color:#1f3b73; color:#e7efff}
  .purple{background:#3d1d6e; border-color:#5b32a1; color:#f2e8ff}
  .reddish{background:#6f3a12; border-color:#5b2e0d; color:#ffe9d5}
  .neg{background:#d79b11; border-color:#b57f05; color:#111}
  .dropzone{display:grid; gap:6px; place-items:center}
  .drag{width:120px; cursor:grab; user-select:none}
  .drag:active{cursor:grabbing}
  .drag-target{outline:3px dashed #0f172a; outline-offset:6px; border-radius:16px}

  /* controls tengah + status nempel di antara tombol */
  .controls-center{ justify-content: center; }
  .controls-inner{ display:flex; align-items:center; }
  .controls-inner > *{ margin-right:10px; }
  .controls-inner > *:last-child{ margin-right:0; }
  .status-badge{ background:#0f172a; color:#fff; padding:8px 12px; border-radius:10px; font-weight:800; box-shadow:0 2px 8px #0003 }

  /* ===== Table ===== */
  table{width:min(900px,95%); margin:8px auto; border-collapse:collapse; color:#0f172a; background:#fff; border-radius:12px; overflow:hidden}
  th,td{border:1px solid #cbd5e1; padding:12px; font-size:15px}
  th{background:#e5edff; text-transform:uppercase; font-weight:900}
  .posTxt{color:#065f46; font-weight:800}
  .dexTxt{color:#4c1d95; font-weight:800}
  .gliTxt{color:#7c2d12; font-weight:800}
  .negTxt{color:#991b1b; font-weight:800}

  @media (max-width:980px){
    .grid-2{grid-template-columns:1fr}
    .plate{width:120px; height:120px}
    .controls-inner{flex-wrap:wrap; justify-content:center}
  }
</style>
</head>
<body>

<div class="title">Virtual Laboratorium â€“ Uji Iodin (Lugol)</div>

<!-- =================== STAGE 1: ALAT =================== -->
<div id="stage1" class="stage-wrap active">
  <div class="grid-2">
    <div class="col">
      <div class="slots">
        <div class="row">
          <div class="slot" data-tool="dropper" title="Dropper/Pipet"><img src="assets/ui/tools/pipette.png" alt=""></div>
          <div class="slot" data-tool="iodine"  title="Larutan Iodin"><img src="assets/ui/reagents/iodine.png" alt=""></div>
          <div class="slot" data-tool="plate"   title="Piring Uji"><img src="assets/ui/tools/plate.png" alt=""></div>
          <div class="slot" data-tool="beaker"  title="Beaker"><img src="assets/ui/tools/beaker.png" alt=""></div>
        </div>
        <div class="row">
          <div class="slot" data-tool="testtube" title="Tabung Reaksi"><img src="assets/ui/tools/testtube.png" alt=""></div>
          <div class="slot" data-tool="rack"     title="Rak Tabung"><img src="assets/ui/tools/rack.png" alt=""></div>
          <div class="slot" data-tool="cylinder" title="Gelas Ukur"><img src="assets/ui/tools/cylinder.png" alt=""></div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card">
        <div class="sign"><b>Stage 1 â€“ Persiapan Alat</b><br>Pilih alat yang dibutuhkan untuk uji iodin.</div>
        <div style="align-self:center; text-align:center">
          <div id="pickedTools" style="font-weight:800;color:var(--muted)">Alat terpilih: 0</div>
          <div>Minimal alat: <b id="reqTools">4</b></div>
        </div>
        <div class="controls"><button id="toStage2" class="btn" disabled>Next âžœ Pilih Bahan</button></div>
        <div class="plinth"></div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 2: BAHAN =================== -->
<div id="stage2" class="stage-wrap">
  <div class="grid-2">
    <div class="col">
      <div class="slots">
        <div class="row">
          <div class="slot" data-ingredient="nasi"   title="Nasi"><img src="assets/ui/ingredients/rice.png" alt=""></div>
          <div class="slot" data-ingredient="roti"   title="Roti"><img src="assets/ui/ingredients/bread.png" alt=""></div>
          <div class="slot" data-ingredient="pisang" title="Pisang"><img src="assets/ui/ingredients/banana.png" alt=""></div>
          <div class="slot" data-ingredient="susu"   title="Susu"><img src="assets/ui/ingredients/milk.png" alt=""></div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card">
        <div class="sign"><b>Stage 2 â€“ Pilih Bahan</b><br>Pilih 4 sampel makanan yang akan diuji.</div>
        <div style="align-self:center; text-align:center">
          <div id="pickedIng" style="font-weight:800;color:var(--muted)">Bahan terpilih: 0</div>
          <div>Minimal bahan: <b id="reqIng">4</b></div>
        </div>
        <div class="controls">
          <button id="backTo1" class="btn back">â¬… Kembali</button>
          <button id="toStage3" class="btn" disabled>Next âžœ Uji Iodin</button>
        </div>
        <div class="plinth"></div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 3: UJI IODIN =================== -->
<div id="stage3" class="stage-wrap">
  <div class="grid-1">
    <div class="col">
      <div class="card" style="grid-template-rows:auto 1fr auto">
        <div class="sign"><b>Stage 3 â€“ Uji Iodin</b><br>Tarik <b>Botol Iodin</b> ke plate di bawah (panel <i>SESUDAH</i>).</div>

        <div class="bench panel">
          <h3>HASIL SETELAH DITETESKAN LARUTAN LUGOL</h3>
          <div class="plates" id="afterPlates">
            <div class="plate drop" data-sample="nasi"><div class="label">NASI</div></div>
            <div class="plate drop" data-sample="pisang"><div class="label">PISANG</div></div>
            <div class="plate drop" data-sample="roti"><div class="label">ROTI</div></div>
            <div class="plate drop" data-sample="susu"><div class="label">SUSU</div></div>
          </div>
          <div class="dropzone">
            <img id="iodine" class="drag" src="assets/ui/reagents/iodine.png" alt="Iodin" draggable="true">
            <div style="font-weight:800; color:#0f172a">Seret IODIN ke setiap plate</div>
          </div>
        </div>

        <!-- controls center, status di antara tombol -->
        <div class="controls controls-center" style="margin-top:auto">
          <div class="controls-inner">
            <button id="backTo2" class="btn back">â¬… Bahan</button>
            <span id="status" class="status-badge">Belum diuji</span>
            <button id="toStage4" class="btn" disabled>Next âžœ Penjelasan & Rekap</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 4: PENJELASAN & TABEL =================== -->
<div id="stage4" class="stage-wrap">
  <div class="grid-1">
    <div class="col">
      <div class="card" style="grid-template-rows:auto auto 1fr auto">
        <div class="sign"><b>Hasil Uji Iodin â€“ Penjelasan Warna</b></div>

        <div style="background:#fff; color:#111; border-radius:12px; padding:18px; margin:0 12px">
          <p style="margin:0 0 8px 0"><b>Kemungkinan menghasilkan warna:</b></p>
          <ol style="margin:0; padding-left:20px; line-height:1.6">
            <li><b>Biru kehitaman</b> â†’ menunjukkan <b>amilum (pati)</b> <i>[positif kuat]</i></li>
            <li><b>Ungu</b> â†’ menunjukkan <b>dekstrin</b> (pemecahan pati parsial)</li>
            <li><b>Coklat kemerahan</b> â†’ menunjukkan <b>glikogen/reaksi lemah</b> (atau non-pati tertentu)</li>
          </ol>
        </div>

        <div id="tableWrap" style="margin-top:12px"></div>

        <div class="controls">
          <button id="backTo3" class="btn back">â¬… Kembali</button>
          <button id="restart" class="btn">ðŸ”„ Ulang Dari Awal</button>
        </div>
        <div class="plinth"></div>
      </div>
    </div>
  </div>
</div>

<script>
  /* ===== helpers ===== */
  const showStage = id => {
    document.querySelectorAll('.stage-wrap').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo({top:0,behavior:'instant'});
    history.replaceState({}, '', '#'+id);
  };
  const $all = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

  /* ===== Stage 1 ===== */
  (function(){
    const req = 4; let count = 0;
    document.getElementById('reqTools').textContent = req;
    const picked = document.getElementById('pickedTools');
    const nextBtn = document.getElementById('toStage2');

    $all('#stage1 .slot[data-tool]').forEach(slot=>{
      slot.addEventListener('click', ()=>{
        if(!slot.classList.contains('selected')){
          slot.classList.add('selected'); count++;
          picked.textContent = 'Alat terpilih: ' + count;
          if(count>=req) nextBtn.disabled = false;
        }
      });
    });
    nextBtn.addEventListener('click', ()=> showStage('stage2'));
  })();

  /* ===== Stage 2 ===== */
  (function(){
    const req = 4; let count = 0;
    document.getElementById('reqIng').textContent = req;
    const picked = document.getElementById('pickedIng');
    const back = document.getElementById('backTo1');
    const next = document.getElementById('toStage3');

    $all('#stage2 .slot[data-ingredient]').forEach(slot=>{
      slot.addEventListener('click', ()=>{
        if(!slot.classList.contains('selected')){
          slot.classList.add('selected'); count++;
          picked.textContent = 'Bahan terpilih: ' + count;
          if(count>=req) next.disabled = false;
        }
      });
    });
    back.addEventListener('click', ()=> showStage('stage1'));
    next.addEventListener('click', ()=> showStage('stage3'));
  })();

  /* ===== Stage 3: uji iodin ===== */
  (function(){
    const iodineDrag = document.getElementById('iodine');
    const plates = $all('#afterPlates .plate.drop');
    const statusEl = document.getElementById('status');
    const next = document.getElementById('toStage4');
    const back = document.getElementById('backTo2');

    // Mapping hasil (ubah sesuai kebutuhan)
    // 'bb' = biru kehitaman (pati); 'purple' = ungu (dekstrin);
    // 'reddish' = coklat kemerahan (glikogen/reaksi lemah); 'neg' = negatif
    const iodineResults = { nasi:'bb', roti:'bb', pisang:'reddish', susu:'neg' };

    const tested = new Map();

    iodineDrag.addEventListener('dragstart', e=>{
      e.dataTransfer.setData('text/plain', 'iodine');
    });

    const labelText = (cat) => (
      cat==='bb'      ? 'Positif (biru kehitaman)' :
      cat==='purple'  ? 'Ungu (dekstrin)' :
      cat==='reddish' ? 'Coklat kemerahan (glikogen/reaksi lemah)' :
                        'Negatif (warna iodin tetap)'
    );

    plates.forEach(p=>{
      p.addEventListener('dragover', e=>{ e.preventDefault(); p.classList.add('drag-target'); });
      p.addEventListener('dragleave', ()=> p.classList.remove('drag-target'));
      p.addEventListener('drop', e=>{
        e.preventDefault(); p.classList.remove('drag-target');
        if(e.dataTransfer.getData('text/plain')!=='iodine') return;

        const sample = p.dataset.sample;
        if(tested.has(sample)) return;

        const cat = iodineResults[sample] ?? 'neg';
        tested.set(sample, cat);

        p.classList.remove('bb','purple','reddish','neg');
        p.classList.add(cat);

        statusEl.textContent = `${sample.toUpperCase()}: ${labelText(cat)}`;
        if(tested.size === plates.length) next.disabled = false;
      });
    });

    back.addEventListener('click', ()=> showStage('stage2'));
    next.addEventListener('click', ()=>{
      renderTable(tested);
      showStage('stage4');
    });

    function renderTable(map){
      const wrap = document.getElementById('tableWrap');
      const rows = Array.from(map.entries()).map(([s,cat])=>{
        const S = s[0].toUpperCase()+s.slice(1);
        const hasil =
          cat==='bb'      ? '<span class="posTxt">Positif (biru kehitaman)</span>' :
          cat==='purple'  ? '<span class="dexTxt">Ungu (dekstrin)</span>' :
          cat==='reddish' ? '<span class="gliTxt">Coklat kemerahan</span>' :
                            '<span class="negTxt">Negatif</span>';
        const ket =
          cat==='bb'      ? 'Mengandung amilum/pati' :
          cat==='purple'  ? 'Mengandung dekstrin (pecahan pati)' :
          cat==='reddish' ? 'Reaksi khas glikogen/pewarna coklat' :
                            'Tidak menunjukkan pati';
        return `<tr><td>${S}</td><td>${hasil}</td><td>${ket}</td></tr>`;
      }).join('');
      wrap.innerHTML = `
        <table>
          <thead><tr><th>SAMPEL</th><th>HASIL</th><th>KETERANGAN</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }
  })();

  /* ===== Stage 4 ===== */
  (function(){
    document.getElementById('backTo3').addEventListener('click', ()=> showStage('stage3'));
    document.getElementById('restart').addEventListener('click', ()=> location.reload());
  })();

  /* Deep link */
  if(location.hash){
    const id = location.hash.slice(1);
    if(document.getElementById(id)) showStage(id);
  }
</script>
</body>
</html>
