<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Virtual Laboratorium â€“ Uji Iodin (Lugol)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      colors: {
        'accent': '#f59e0b',
        'ink': '#0f172a',
        'panel': '#eef3ff',
      },
      extend: {
        fontFamily: {
          inter: ['Inter', 'system-ui'],
        }
      }
    }
  }
</script>
<style>
  :root {
    --bg: #0b1020;
    --panel: #eef3ff;
    --text: #eaf2ff;
    --ink: #0f172a;
    --muted: #6b7280;
    --ok: #10b981;
  }
  body { background: radial-gradient(1400px 900px at 80% -10%, #1b2c68 0%, #0b1020 60%, #050713 100%); }
  @keyframes fade { from { opacity: 0.7; transform: translateY(2px); } to { opacity: 1; transform: none; } }
  .stage-wrap { display: none; animation: fade 0.28s ease; }
  .stage-wrap.active { display: block; }
</style>
</head>
<body class="text-white font-inter overflow-x-hidden">

<div class="sticky top-0 text-center px-3 py-3 z-50 font-black text-2xl md:text-3xl lg:text-4xl tracking-wide text-pink-200 text-shadow bg-gradient-to-b from-gray-900 to-transparent backdrop-blur">Virtual Laboratorium â€“ Uji Iodin (Lugol)</div>

<!-- =================== STAGE 1: ALAT =================== -->
<div id="stage1" class="stage-wrap active">
  <div class="grid grid-cols-[38%_1fr] gap-4 p-5 min-h-[calc(100dvh-64px)]">
    <div class="relative">
      <div class="relative h-[78vh] bg-blue-100 rounded-2xl p-3 border-2 border-indigo-200 shadow-xl overflow-y-auto">
        <div class="flex flex-col gap-1.5">
          <div class="flex gap-3 items-center px-1.5 py-1">
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="dropper" title="Dropper/Pipet"><img src="../assets/tools/pipette.png" alt="" class="max-w-13 max-h-13"></button>
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="iodine" title="Larutan Iodin"><img src="../assets/reagents/iodine.png" alt="" class="max-w-13 max-h-13"></button>
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="plate" title="Piring Uji"><img src="../assets/tools/plate.png" alt="" class="max-w-13 max-h-13"></button>
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="beaker" title="Beaker"><img src="../assets/tools/beaker.png" alt="" class="max-w-13 max-h-13"></button>
          </div>
          <div class="flex gap-3 items-center px-1.5 py-1">
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="testtube" title="Tabung Reaksi"><img src="../assets/tools/testtube.png" alt="" class="max-w-13 max-h-13"></button>
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="rack" title="Rak Tabung"><img src="../assets/tools/rack.png" alt="" class="max-w-13 max-h-13"></button>
            <button class="w-16 h-16 rounded-2xl grid place-items-center bg-white bg-opacity-80 border-2 border-blue-50 cursor-pointer transition hover:-translate-y-0.5" data-tool="cylinder" title="Gelas Ukur"><img src="../assets/tools/cylinder.png" alt="" class="max-w-13 max-h-13"></button>
          </div>
        </div>
      </div>
    </div>

    <div class="relative">
      <div class="relative h-[min(78vh,780px)] bg-gradient-to-b from-blue-50 to-indigo-100 border-2 border-indigo-200 rounded-2xl shadow-2xl grid grid-rows-[auto_1fr_auto] p-4 text-ink">
        <div class="mx-auto mb-2.5 w-[min(560px,92%)] text-center px-4 py-3.5 bg-white bg-opacity-95 border-2 border-indigo-400 rounded-2xl font-bold"><b>Stage 1 â€“ Persiapan Alat</b><br>Pilih alat yang dibutuhkan untuk uji iodin.</div>
        <div class="self-center text-center">
          <div id="pickedTools" class="font-black text-muted">Alat terpilih: 0</div>
          <div>Minimal alat: <b id="reqTools">4</b></div>
        </div>
        <div class="flex justify-center gap-2.5 mt-2.5">
          <button id="toStage2" class="bg-accent text-ink font-black px-4 py-2.5 border-0 rounded-2xl cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" disabled>Next âžœ Pilih Bahan</button>
        </div>
        <div class="absolute left-1/2 -translate-x-1/2 -bottom-3.5 w-[min(520px,90%)] h-8 bg-gradient-to-b from-yellow-700 to-yellow-900 rounded-b-2xl shadow-2xl"></div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 2: BAHAN =================== -->
<div id="stage2" class="stage-wrap">
  <div class="grid-2">
    <div class="col">
      <div class="slots">
        <div class="row">
          <div class="slot" data-ingredient="nasi"   title="Nasi"><img src="../assets/ingredients/rice.png" alt=""></div>
          <div class="slot" data-ingredient="roti"   title="Roti"><img src="../assets/ingredients/bread.png" alt=""></div>
          <div class="slot" data-ingredient="pisang" title="Pisang"><img src="../assets/ingredients/banana.png" alt=""></div>
          <div class="slot" data-ingredient="susu"   title="Susu"><img src="../assets/ingredients/milk.png" alt=""></div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card">
        <div class="sign"><b>Stage 2 â€“ Pilih Bahan</b><br>Pilih 4 sampel makanan yang akan diuji.</div>
        <div style="align-self:center; text-align:center">
          <div id="pickedIng" style="font-weight:800;color:var(--muted)">Bahan terpilih: 0</div>
          <div>Minimal bahan: <b id="reqIng">4</b></div>
        </div>
        <div class="controls">
          <button id="backTo1" class="btn back">â¬… Kembali</button>
          <button id="toStage3" class="btn" disabled>Next âžœ Uji Iodin</button>
        </div>
        <div class="plinth"></div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 3: UJI IODIN =================== -->
<div id="stage3" class="stage-wrap">
  <div class="grid-1">
    <div class="col">
      <div class="card" style="grid-template-rows:auto 1fr auto">
        <div class="sign"><b>Stage 3 â€“ Uji Iodin</b><br>Tarik <b>Botol Iodin</b> ke plate di bawah (panel <i>SESUDAH</i>).</div>

        <div class="bench panel">
          <h3>HASIL SETELAH DITETESKAN LARUTAN LUGOL</h3>
          <div class="plates" id="afterPlates">
            <div class="plate drop" data-sample="nasi"><div class="label">NASI</div></div>
            <div class="plate drop" data-sample="pisang"><div class="label">PISANG</div></div>
            <div class="plate drop" data-sample="roti"><div class="label">ROTI</div></div>
            <div class="plate drop" data-sample="susu"><div class="label">SUSU</div></div>
          </div>
          <div class="dropzone">
            <img id="iodine" class="drag" src="../assets/reagents/iodine.png" alt="Iodin" draggable="true">
            <div style="font-weight:800; color:#0f172a">Seret IODIN ke setiap plate</div>
          </div>
        </div>

        <!-- controls center, status di antara tombol -->
        <div class="controls controls-center" style="margin-top:auto">
          <div class="controls-inner">
            <button id="backTo2" class="btn back">â¬… Bahan</button>
            <span id="status" class="status-badge">Belum diuji</span>
            <button id="toStage4" class="btn" disabled>Next âžœ Penjelasan & Rekap</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- =================== STAGE 4: PENJELASAN & TABEL =================== -->
<div id="stage4" class="stage-wrap">
  <div class="grid-1">
    <div class="col">
      <div class="card" style="grid-template-rows:auto auto 1fr auto">
        <div class="sign"><b>Hasil Uji Iodin â€“ Penjelasan Warna</b></div>

        <div style="background:#fff; color:#111; border-radius:12px; padding:18px; margin:0 12px">
          <p style="margin:0 0 8px 0"><b>Kemungkinan menghasilkan warna:</b></p>
          <ol style="margin:0; padding-left:20px; line-height:1.6">
            <li><b>Biru kehitaman</b> â†’ menunjukkan <b>amilum (pati)</b> <i>[positif kuat]</i></li>
            <li><b>Ungu</b> â†’ menunjukkan <b>dekstrin</b> (pemecahan pati parsial)</li>
            <li><b>Coklat kemerahan</b> â†’ menunjukkan <b>glikogen/reaksi lemah</b> (atau non-pati tertentu)</li>
          </ol>
        </div>

        <div id="tableWrap" style="margin-top:12px"></div>

        <div class="controls">
          <button id="backTo3" class="btn back">â¬… Kembali</button>
          <button id="restart" class="btn">ðŸ”„ Ulang Dari Awal</button>
        </div>
        <div class="plinth"></div>
      </div>
    </div>
  </div>
</div>

<script>
  /* ===== helpers ===== */
  const showStage = id => {
    document.querySelectorAll('.stage-wrap').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo({top:0,behavior:'instant'});
    history.replaceState({}, '', '#'+id);
  };
  const $all = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

  /* ===== Stage 1 ===== */
  (function(){
    const req = 4; let count = 0;
    document.getElementById('reqTools').textContent = req;
    const picked = document.getElementById('pickedTools');
    const nextBtn = document.getElementById('toStage2');

    $all('#stage1 .slot[data-tool]').forEach(slot=>{
      slot.addEventListener('click', ()=>{
        if(!slot.classList.contains('selected')){
          slot.classList.add('selected'); count++;
          picked.textContent = 'Alat terpilih: ' + count;
          if(count>=req) nextBtn.disabled = false;
        }
      });
    });
    nextBtn.addEventListener('click', ()=> showStage('stage2'));
  })();

  /* ===== Stage 2 ===== */
  (function(){
    const req = 4; let count = 0;
    document.getElementById('reqIng').textContent = req;
    const picked = document.getElementById('pickedIng');
    const back = document.getElementById('backTo1');
    const next = document.getElementById('toStage3');

    $all('#stage2 .slot[data-ingredient]').forEach(slot=>{
      slot.addEventListener('click', ()=>{
        if(!slot.classList.contains('selected')){
          slot.classList.add('selected'); count++;
          picked.textContent = 'Bahan terpilih: ' + count;
          if(count>=req) next.disabled = false;
        }
      });
    });
    back.addEventListener('click', ()=> showStage('stage1'));
    next.addEventListener('click', ()=> showStage('stage3'));
  })();

  /* ===== Stage 3: uji iodin ===== */
  (function(){
    const iodineDrag = document.getElementById('iodine');
    const plates = $all('#afterPlates .plate.drop');
    const statusEl = document.getElementById('status');
    const next = document.getElementById('toStage4');
    const back = document.getElementById('backTo2');

    // Mapping hasil (ubah sesuai kebutuhan)
    // 'bb' = biru kehitaman (pati); 'purple' = ungu (dekstrin);
    // 'reddish' = coklat kemerahan (glikogen/reaksi lemah); 'neg' = negatif
    const iodineResults = { nasi:'bb', roti:'bb', pisang:'reddish', susu:'neg' };

    const tested = new Map();

    iodineDrag.addEventListener('dragstart', e=>{
      e.dataTransfer.setData('text/plain', 'iodine');
    });

    const labelText = (cat) => (
      cat==='bb'      ? 'Positif (biru kehitaman)' :
      cat==='purple'  ? 'Ungu (dekstrin)' :
      cat==='reddish' ? 'Coklat kemerahan (glikogen/reaksi lemah)' :
                        'Negatif (warna iodin tetap)'
    );

    plates.forEach(p=>{
      p.addEventListener('dragover', e=>{ e.preventDefault(); p.classList.add('drag-target'); });
      p.addEventListener('dragleave', ()=> p.classList.remove('drag-target'));
      p.addEventListener('drop', e=>{
        e.preventDefault(); p.classList.remove('drag-target');
        if(e.dataTransfer.getData('text/plain')!=='iodine') return;

        const sample = p.dataset.sample;
        if(tested.has(sample)) return;

        const cat = iodineResults[sample] ?? 'neg';
        tested.set(sample, cat);

        p.classList.remove('bb','purple','reddish','neg');
        p.classList.add(cat);

        statusEl.textContent = `${sample.toUpperCase()}: ${labelText(cat)}`;
        if(tested.size === plates.length) next.disabled = false;
      });
    });

    back.addEventListener('click', ()=> showStage('stage2'));
    next.addEventListener('click', ()=>{
      renderTable(tested);
      showStage('stage4');
    });

    function renderTable(map){
      const wrap = document.getElementById('tableWrap');
      const rows = Array.from(map.entries()).map(([s,cat])=>{
        const S = s[0].toUpperCase()+s.slice(1);
        const hasil =
          cat==='bb'      ? '<span class="posTxt">Positif (biru kehitaman)</span>' :
          cat==='purple'  ? '<span class="dexTxt">Ungu (dekstrin)</span>' :
          cat==='reddish' ? '<span class="gliTxt">Coklat kemerahan</span>' :
                            '<span class="negTxt">Negatif</span>';
        const ket =
          cat==='bb'      ? 'Mengandung amilum/pati' :
          cat==='purple'  ? 'Mengandung dekstrin (pecahan pati)' :
          cat==='reddish' ? 'Reaksi khas glikogen/pewarna coklat' :
                            'Tidak menunjukkan pati';
        return `<tr><td>${S}</td><td>${hasil}</td><td>${ket}</td></tr>`;
      }).join('');
      wrap.innerHTML = `
        <table>
          <thead><tr><th>SAMPEL</th><th>HASIL</th><th>KETERANGAN</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }
  })();

  /* ===== Stage 4 ===== */
  (function(){
    document.getElementById('backTo3').addEventListener('click', ()=> showStage('stage3'));
    document.getElementById('restart').addEventListener('click', ()=> location.reload());
  })();

  /* Deep link */
  if(location.hash){
    const id = location.hash.slice(1);
    if(document.getElementById(id)) showStage(id);
  }
</script>
</body>
</html>
